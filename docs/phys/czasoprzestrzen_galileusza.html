<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Czasoprzestrzeń Galileusza - Split View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Globalne ustawienia */
        body { margin: 0; overflow: hidden; background-color: #0f172a; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #e2e8f0; }
        
        /* Styl suwaka */
        .slider { -webkit-appearance: none; width: 100%; height: 6px; border-radius: 5px; background: #475569; outline: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #3b82f6; cursor: pointer; border: 2px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.5); }
        
        /* Boxy informacyjne */
        .calc-box { font-family: 'Courier New', monospace; background: #1e293b; color: #cbd5e1; padding: 12px; border-radius: 6px; font-size: 0.85rem; border-left: 4px solid #f59e0b; border: 1px solid #334155; }
        .calc-row { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .calc-val { color: #34d399; font-weight: bold; }
        .calc-header { color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; border-bottom: 1px solid #334155; margin-bottom: 8px; padding-bottom: 4px;}

        /* Legenda */
        .legend-row { display: flex; align-items: center; margin-bottom: 8px; font-size: 0.85rem; color: #cbd5e1; }
        .color-box { width: 14px; height: 14px; margin-right: 10px; border-radius: 3px; flex-shrink: 0; }
        
        /* Scrollbar dla panelu bocznego */
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-track { background: #0f172a; }
        .sidebar::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    </style>
</head>
<body class="flex h-screen w-screen">

    <!-- LEWA KOLUMNA: Panel Sterowania i Opis -->
    <div class="sidebar w-[400px] flex-shrink-0 bg-slate-900 border-r border-slate-700 flex flex-col overflow-y-auto z-10 shadow-2xl">
        <div class="p-6 space-y-6">
            
            <!-- Nagłówek -->
            <div class="border-b border-slate-700 pb-4">
                <h1 class="text-xl font-bold text-gray-100">Czasoprzestrzeń Galileusza</h1>
                <p class="text-xs text-gray-400 mt-1">Interaktywna analiza transformacji</p>
            </div>

            <!-- Kontrolery -->
            <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
                <label class="block text-sm font-bold text-gray-200 mb-3">Prędkość układu (v)</label>
                <div class="flex items-center space-x-3 mb-2">
                    <span class="text-xs font-mono text-gray-500">-1.5</span>
                    <input type="range" id="vSlider" min="-1.5" max="1.5" step="0.01" value="0.6" class="slider">
                    <span class="text-xs font-mono text-gray-500">1.5</span>
                </div>
                <div class="flex justify-between items-center mt-1">
                    <span class="text-xs text-gray-400">Ruch w lewo / prawo</span>
                    <span class="text-sm font-mono text-gray-400">v = <span id="vValue" class="font-bold text-blue-400 text-lg">0.60</span></span>
                </div>
            </div>

            <!-- Panel weryfikacji -->
            <div>
                <h3 class="text-xs font-bold text-gray-400 uppercase mb-3 tracking-wider">Weryfikacja Matematyczna</h3>
                <div class="text-xs text-gray-400 mb-3 font-mono bg-slate-800 p-2 rounded border border-slate-700">
                    x' = x - (v · t)<br>
                    t  = 3.0 (stałe)
                </div>
                
                <div class="calc-box mb-3">
                    <div class="calc-header">Zdarzenie A (Prawa strona)</div>
                    <div class="calc-row"><span>x (Ty):</span> <span>2.00</span></div>
                    <div class="calc-row"><span>v · t:</span> <span id="vtCalc_A">1.80</span></div>
                    <div class="calc-row border-t border-slate-600 pt-2 mt-1">
                        <span>x' (Wynik):</span> <span id="res_A" class="calc-val">0.20</span>
                    </div>
                </div>

                <div class="calc-box">
                    <div class="calc-header">Zdarzenie B (Lewa strona)</div>
                    <div class="calc-row"><span>x (Ty):</span> <span>-2.00</span></div>
                    <div class="calc-row"><span>v · t:</span> <span id="vtCalc_B">1.80</span></div>
                    <div class="calc-row border-t border-slate-600 pt-2 mt-1">
                        <span>x' (Wynik):</span> <span id="res_B" class="calc-val">-3.80</span>
                    </div>
                </div>
            </div>

            <!-- Legenda -->
            <div class="border-t border-slate-700 pt-4">
                <h3 class="text-xs font-bold text-gray-400 uppercase mb-3">Legenda</h3>
                <div class="legend-row">
                    <div class="color-box bg-red-500"></div>
                    <span>Zdarzenia A i B (Czerwone kropki)</span>
                </div>
                <div class="legend-row">
                    <div class="color-box bg-slate-400"></div>
                    <span>Układ Nieruchomy (Szary/Czarny)</span>
                </div>
                <div class="legend-row">
                    <div class="color-box bg-blue-400"></div>
                    <span>Oś czasu ruchoma t' (Niebieska)</span>
                </div>
                <div class="legend-row">
                    <div class="color-box bg-amber-400"></div>
                    <span>Rzut Galileusza (Żółta linia przerywana)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- PRAWA KOLUMNA: Scena / Canvas -->
    <div id="scene-container" class="flex-1 bg-slate-950 relative overflow-hidden flex items-center justify-center">
        <!-- Canvas wypełni ten kontener -->
        <canvas id="canvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const sceneContainer = document.getElementById('scene-container');
        const ctx = canvas.getContext('2d');
        const vSlider = document.getElementById('vSlider');
        const vValueSpan = document.getElementById('vValue');
        
        const vtCalcA = document.getElementById('vtCalc_A');
        const resA = document.getElementById('res_A');
        const vtCalcB = document.getElementById('vtCalc_B');
        const resB = document.getElementById('res_B');

        let scale = 50; 
        let velocity = 0.6;
        
        const eventA = { x: 2, t: 3, label: "A" };
        const eventB = { x: -2, t: 3, label: "B" };

        function resize() {
            // Pobieramy wymiary kontenera prawej kolumny, a nie całego okna
            canvas.width = sceneContainer.clientWidth;
            canvas.height = sceneContainer.clientHeight;
            draw();
        }
        window.addEventListener('resize', resize);

        function toScreen(x, t) {
            // Centrujemy względem aktualnego wymiaru canvasa
            const centerX = canvas.width / 2;
            const centerY = canvas.height * 0.75; 
            return {
                x: centerX + x * scale,
                y: centerY - t * scale
            };
        }

        function drawGrid(v) {
            // Dostosowanie zakresu rysowania do szerokości ekranu
            // Im szerszy ekran, tym więcej kratek rysujemy
            const rangeX = Math.ceil(canvas.width / (2 * scale)) + 2;
            const rangeT = Math.ceil(canvas.height / scale) + 2;
            
            ctx.lineWidth = 1;

            // 1. Siatka Tła (Nieruchoma) - Ciemnoszara
            ctx.strokeStyle = '#334155'; // Slate-700
            for (let i = -rangeX; i <= rangeX; i++) {
                let p1 = toScreen(i, -5);
                let p2 = toScreen(i, rangeT);
                ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
            }
            for (let i = -5; i <= rangeT; i++) {
                let p1 = toScreen(-rangeX, i);
                let p2 = toScreen(rangeX, i);
                ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
            }

            // 2. Osie Główne - Jasnoszare
            ctx.strokeStyle = '#94a3b8'; // Slate-400
            ctx.lineWidth = 2;
            
            // Oś t (Pionowa)
            ctx.beginPath();
            let start = toScreen(0, -5);
            let end = toScreen(0, rangeT - 2);
            ctx.moveTo(start.x, start.y);
            ctx.lineTo(end.x, end.y);
            ctx.stroke();
            ctx.fillStyle = '#cbd5e1'; 
            ctx.font = 'bold 14px Arial';
            ctx.fillText("t", end.x - 20, end.y + 10);

            // Oś x (Pozioma)
            ctx.beginPath();
            start = toScreen(-rangeX, 0);
            end = toScreen(rangeX, 0);
            ctx.moveTo(start.x, start.y);
            ctx.lineTo(end.x, end.y);
            ctx.stroke();
            ctx.fillText("x", end.x - 30, end.y + 20);

            // 3. Oś t' (Ruchoma)
            ctx.strokeStyle = '#60a5fa'; // Blue-400
            ctx.lineWidth = 3;
            ctx.beginPath();
            start = toScreen(v * -5, -5);
            end = toScreen(v * (rangeT-2), rangeT-2);
            ctx.moveTo(start.x, start.y);
            ctx.lineTo(end.x, end.y);
            ctx.stroke();
            
            ctx.fillStyle = '#60a5fa';
            ctx.fillText("t'", end.x + 10, end.y);
        }

        function drawProjection(ev, v) {
            const screenP = toScreen(ev.x, ev.t);
            const xPrime = ev.x - v * ev.t; 
            const pAxisMove = toScreen(xPrime, 0); 

            // RYSOWANIE RZUTU (Żółta linia)
            ctx.strokeStyle = '#fbbf24'; // Amber-400
            ctx.lineWidth = 2;
            ctx.setLineDash([6, 3]);

            ctx.beginPath();
            ctx.moveTo(screenP.x, screenP.y);
            ctx.lineTo(pAxisMove.x, pAxisMove.y);
            ctx.stroke();
            ctx.setLineDash([]); 

            // Etykieta wyniku na osi
            ctx.fillStyle = '#fbbf24';
            ctx.font = 'bold 12px monospace';
            ctx.textAlign = 'center';
            ctx.fillText(xPrime.toFixed(2), pAxisMove.x, pAxisMove.y + 20);

            // Wektor przesunięcia na osi
            const pVerticalProj = toScreen(ev.x, 0); 
            
            if (Math.abs(v) > 0.05) {
                ctx.beginPath();
                ctx.strokeStyle = '#f87171'; // Red-400
                ctx.lineWidth = 1;
                ctx.moveTo(pVerticalProj.x, pVerticalProj.y);
                ctx.lineTo(pAxisMove.x, pAxisMove.y);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.arc(pAxisMove.x, pAxisMove.y, 2, 0, Math.PI*2);
                ctx.fill();
            }
        }

        function drawEventPoint(ev) {
            const p = toScreen(ev.x, ev.t);
            
            // Linia pionowa (rzut klasyczny)
            ctx.strokeStyle = '#64748b'; // Slate-500
            ctx.lineWidth = 1;
            ctx.setLineDash([2, 2]);
            ctx.beginPath();
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(toScreen(ev.x, 0).x, toScreen(ev.x, 0).y);
            ctx.stroke();
            ctx.setLineDash([]);

            // Kropka
            ctx.fillStyle = '#ef4444'; // Red-500
            ctx.beginPath();
            ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // Label
            ctx.fillStyle = '#f1f5f9';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(ev.label, p.x + 10, p.y - 10);
            
            ctx.fillStyle = '#94a3b8'; // Slate-400
            ctx.font = '11px monospace';
            ctx.fillText(`x=${ev.x}`, p.x + 10, p.y + 5);
        }

        function updateCalculator(v) {
            const vtA = v * eventA.t;
            const resValA = eventA.x - vtA;
            vtCalcA.textContent = `${(v*eventA.t).toFixed(2)}`;
            resA.textContent = resValA.toFixed(2);

            const vtB = v * eventB.t;
            const resValB = eventB.x - vtB;
            vtCalcB.textContent = `${(v*eventB.t).toFixed(2)}`;
            resB.textContent = resValB.toFixed(2);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            velocity = parseFloat(vSlider.value);
            vValueSpan.textContent = velocity.toFixed(2);

            drawGrid(velocity);
            drawProjection(eventA, velocity);
            drawProjection(eventB, velocity);
            drawEventPoint(eventA);
            drawEventPoint(eventB);
            updateCalculator(velocity);
        }

        vSlider.addEventListener('input', draw);
        
        // Inicjalizacja: najpierw resize, żeby ustawić rozmiar, potem draw
        resize();

    </script>
</body>
</html>